@model IEnumerable<DrivingSclApp.Areas.Schools.Data.SchoolVM>

<!-- Header -->
<div class="container-fluid" style="text-align:center;">
    <div class="row">
        <div class="col-md-3">
            <div class="editor-label">
                @Html.Label("اسم المدرسة", htmlAttributes: new { @class = "control-label" })
            </div>
            <div class="editor-field">
                @(Html.Kendo().TextBox()
                .Name("SclName").Enable(false)
                .Value(Model.Select(x => x.SCLNAME).FirstOrDefault())
                .HtmlAttributes(new { @class = "form-control", style = "width: 100%; text-align:center;" })
                )
            </div>
        </div>
        <div class="col-md-3">
            <div class="editor-label">
                @Html.Label("رقم الهاتف", htmlAttributes: new { @class = "control-label" })
            </div>
            <div class="editor-field">
                @(Html.Kendo().TextBox()
                .Name("SclPhone")
                .HtmlAttributes(new { placeholder = "أدخل رقم الهاتف", required = "required", validationmessage = "*", @class = "form-control", style = "width: 100%; text-align:center;" })
                )
            </div>
        </div>
        <div class="col-md-3">
            <div class="editor-label">
                @Html.Label("نوع الهاتف", htmlAttributes: new { @class = "control-label" })
            </div>
            <div class="editor-field">
                @(Html.Kendo().DropDownList()
                .OptionLabel("اختر نوع الهاتف")
                .Name("ddlPhoneTyp")
                .DataTextField("Text")
                .DataValueField("Value").HtmlAttributes(new { required = "required", validationmessage = "*" })
                .DataSource(source =>
                {
                    source.Read(read =>
                    {
                        read.Action("GetPhoneTyp", "Codes" , new { area = "indexes" });
                    });
                })
                .HtmlAttributes(new { style = "width: 100%; text-align:cetner;" })
                )
            </div>
        </div>
    </div>
    <div class="row" style="margin:10px;"></div>
    <div class="row" style="text-align:center;">
        @(Html.Kendo().Button()
            .Name("btnPhoneSave")
            .Content("حفظ")
            .HtmlAttributes(new { type = "button", @class = "k-button k-primary", style = "height:35px;width:100px;" })
        )
        @(Html.Kendo().Button()
            .Name("btnPhoneReset")
            .Content("تراجع")
            .HtmlAttributes(new { type = "button", @class = "k-button k-button-icontext k-grid-cancel", style = "height:35px;width:100px;" })
        )
    </div>
    <div class="row" style="margin:10px"></div>
</div>

<!-- Grid -->
<div id="IdivForm">
    <div class="k-rtl">
        @(Html.Kendo().Grid<DrivingSclApp.Areas.Schools.Data.SclPhoneVM>()
            .Name("PhonesGrid")
            .Columns(columns =>
            {
                columns.Command(command => { command.Destroy().Text("حذف"); }).Title("العمليات").Width(100);
                columns.Bound(c => c.NB).Visible(false);
                columns.Bound(c => c.SCL_NB).Visible(false);
                columns.Bound(c => c.PHONE_TYP).Visible(false);
                columns.Bound(c => c.SCL_NAME);
                columns.Bound(c => c.PHONE_NO);
                columns.Bound(c => c.PHONE_TYPE);

            })
            .HtmlAttributes(new { style = "height: auto;" })
            .Sortable()
            .Filterable()
            .DataSource(dataSource => dataSource
            .Ajax()
            .Events(events => events.Error("error_handler").Sync("sync_handler").RequestEnd("OnRequestEnd"))
            .PageSize(15)
            .Model(model => model.Id(p => p.NB))
            .Read(read => read.Action("Read", "SclPhone"))
            .Destroy(update => update.Action("Destroy", "SclPhone")))
            .Resizable(resize => resize
            .Columns(true)
            )
            .Pageable(pageable =>
            {
                pageable.Refresh(true);
                pageable.PageSizes(true);
            })
            )
    </div>
</div>

<script>
    $("#btnPhoneReset").on('click', function () {
        $("#SclPhone").val("");
        $("#ddlSclPhoneTyp").data("kendoDropDownList").value(-1);

        $("#btnPhoneSave").kendoButton({}).data("kendoButton").enable(true);
    })

    $("#btnPhoneSave").on('click', function () {
        var scl = @Model.Select(x => x.NB).FirstOrDefault();
        var phone = $("#SclPhone").val();
        var phonetyp = $("#ddlPhoneTyp").val();
        var phone = {
            SCL_NB: scl,
            PHONE_NO: phone,
            PHONE_TYP: phonetyp
        };

        var model = { "model": phone };

        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "SclPhone")',
            data: model,
            dataType: "JSON",
            success: function (response) {
                var grid = $('#PhonesGrid').data('kendoGrid');
                grid.dataSource.read();
                $('#success_msg').show();
                $('#error_msg').hide();
                $('#labelIdd').text(response.responseText);
            },
        });
    })
</script>